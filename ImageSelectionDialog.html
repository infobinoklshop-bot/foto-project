<!DOCTYPE html>
<html>
<head>
 <base target="_top">
 <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
  
    .original-block {
      background: #e3f2fd;
      padding: 15px 20px;
      border-bottom: 2px solid #2196f3;
      position: sticky;
      top: 0;
      z-index: 90;
    }
  
   .original-block h4 {
     margin: 0 0 10px 0;
     color: #1976d2;
     font-size: 14px;
   }
  
   .content {
     padding: 20px;
     margin-bottom: 80px;
   }
  
   .source-block {
     background: white;
     margin-bottom: 20px;
     border-radius: 8px;
     box-shadow: 0 2px 4px rgba(0,0,0,0.1);
     overflow: hidden;
   }
  
   .source-header {
     padding: 15px 20px;
     background: #f8f9fa;
     border-bottom: 1px solid #eee;
     display: flex;
     justify-content: space-between;
     align-items: center;
   }
  
   .source-title {
     font-weight: bold;
     color: #333;
   }
  
   .select-all-source {
     font-size: 12px;
   }
  
    .images-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ 10 –∫–æ–ª–æ–Ω–æ–∫ */
      gap: 6px;
      padding: 15px;
    }

    .original-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ 10 –∫–æ–ª–æ–Ω–æ–∫ */
      gap: 6px;
    }
  
   .image-item {
     text-align: center;
     border: 2px solid transparent;
     border-radius: 6px;
     padding: 5px;
     transition: border-color 0.2s;
     background: white;
     position: relative;
   }
  
   .image-item:hover {
     border-color: #4285f4;
   }
  
   .image-item.selected {
     border-color: #4285f4;
     background: #e3f2fd;
   }
  
    .image-item img {
      width: 100%;
      height: 70px;     /* –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
      object-fit: cover;
      border-radius: 4px;
      cursor: pointer;
      display: block;
    }
  
   .image-item input {
     margin-top: 5px;
   }
  
   .buttons {
     position: fixed;
     bottom: 0;
     left: 0;
     right: 0;
     background: white;
     padding: 15px 20px;
     border-top: 2px solid #ddd;
     text-align: right;
     box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
   }
  
   button {
     padding: 10px 20px;
     margin-left: 10px;
     border: 1px solid #ddd;
     border-radius: 4px;
     cursor: pointer;
     font-size: 14px;
   }
  
   .primary {
     background: #4285f4;
     color: white;
     border: none;
   }
  
   .primary:hover {
     background: #3367d6;
   }
  
   .primary:disabled {
     background: #ccc;
     cursor: not-allowed;
   }
  
   .counter {
     color: #666;
     font-size: 12px;
   }
 </style>
</head>
<body>

 <div class="original-block">
   <h4>üìã –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)</h4>
   <div class="original-grid" id="originalGrid">
     <? if (originalImages && originalImages.length > 0) { ?>
       <? for (var i = 0; i < originalImages.length; i++) { ?>
         <div class="image-item">
           <img src="<?= originalImages[i] ?>"
                onclick="toggleImageSelection(this)"
                onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22120%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3E–ù–µ—Ç —Ñ–æ—Ç–æ%3C/text%3E%3C/svg%3E'">
           <input type="checkbox"
                  data-source="original"
                  value="<?= originalImages[i] ?>"
                  onchange="updateCounter()">
         </div>
       <? } ?>
     <? } else { ?>
       <div style="padding: 20px; color: #666; text-align: center;">
         –ù–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
       </div>
     <? } ?>
   </div>
 </div>

 <div class="content">
   <? if (supplierImages && supplierImages.length > 0) { ?>
     <div class="source-block">
       <div class="source-header">
         <div class="source-title">üîç –ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º (<?= supplierImages.length ?>)</div>
         <label class="select-all-source">
           <input type="checkbox" onclick="toggleSource(this, 'supplier')">
           –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
         </label>
       </div>
       <div class="images-grid">
         <? for (var i = 0; i < supplierImages.length; i++) { ?>
           <div class="image-item">
             <img src="<?= supplierImages[i] ?>"
                  onclick="toggleImageSelection(this)"
                  onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22120%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3E–û—à–∏–±–∫–∞%3C/text%3E%3C/svg%3E'">
             <input type="checkbox"
                    data-source="supplier"
                    value="<?= supplierImages[i] ?>"
                    onchange="updateCounter()">
           </div>
         <? } ?>
       </div>
     </div>
   <? } ?>

   <? if (additionalImages && additionalImages.length > 0) { ?>
     <div class="source-block">
       <div class="source-header">
         <div class="source-title">üìÅ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (<?= additionalImages.length ?>)</div>
         <label class="select-all-source">
           <input type="checkbox" onclick="toggleSource(this, 'additional')">
           –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
         </label>
       </div>
       <div class="images-grid">
         <? for (var i = 0; i < additionalImages.length; i++) { ?>
           <div class="image-item">
             <img src="<?= additionalImages[i] ?>"
                  onclick="toggleImageSelection(this)"
                  onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22120%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22%3E–û—à–∏–±–∫–∞%3C/text%3E%3C/svg%3E'">
             <input type="checkbox"
                    data-source="additional"
                    value="<?= additionalImages[i] ?>"
                    onchange="updateCounter()">
           </div>
         <? } ?>
       </div>
     </div>
   <? } ?>

   <? if ((!supplierImages || supplierImages.length === 0) &&
          (!additionalImages || additionalImages.length === 0)) { ?>
     <div class="source-block">
       <div style="padding: 40px; text-align: center; color: #666;">
         –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞.<br>
         –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—ã—à–µ.
       </div>
     </div>
   <? } ?>
 </div>

 <div class="buttons">
   <span id="selectedCounter" class="counter">–í—ã–±—Ä–∞–Ω–æ: 0 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</span>
   <button onclick="google.script.host.close()">–û—Ç–º–µ–Ω–∞</button>
   <button class="primary" id="processButton" onclick="processSelectedImages()">
     –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
   </button>
 </div>

 <script>
   // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   function toggleImageSelection(img) {
     const checkbox = img.nextElementSibling;
     checkbox.checked = !checkbox.checked;
    
     const item = img.parentElement;
     if (checkbox.checked) {
       item.classList.add('selected');
     } else {
       item.classList.remove('selected');
     }
    
     updateCounter();
   }

   // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
   function toggleSource(checkbox, source) {
     const checkboxes = document.querySelectorAll(`input[data-source="${source}"]`);
     checkboxes.forEach(cb => {
       cb.checked = checkbox.checked;
       const item = cb.parentElement;
       if (cb.checked) {
         item.classList.add('selected');
       } else {
         item.classList.remove('selected');
       }
     });
     updateCounter();
   }

   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
   function updateCounter() {
     const selected = document.querySelectorAll('input[data-source]:checked');
     const counter = document.getElementById('selectedCounter');
     if (counter) {
       counter.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${selected.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`;
     }
   }

   // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   function processSelectedImages() {
     const selectedUrls = [];
     const checkboxes = document.querySelectorAll('input[data-source]:checked');
    
     checkboxes.forEach(cb => {
       selectedUrls.push(cb.value);
     });

     if (selectedUrls.length === 0) {
       alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏');
       return;
     }

     console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É:', selectedUrls);

     // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
     const button = document.getElementById('processButton');
     button.disabled = true;
     button.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';

     google.script.run
       .withSuccessHandler((result) => {
         console.log('–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
         google.script.host.close();
       })
       .withFailureHandler((error) => {
         console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', error);
         alert('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ' + error.message);
         button.disabled = false;
         button.textContent = '–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ';
       })
       .processSelectedImageUrls(selectedUrls);
   }

   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   window.onload = function() {
     updateCounter();
   };
 </script>
</body>
</html>